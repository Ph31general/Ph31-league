<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ph31 League - Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins', sans-serif; background:#f0f4f8; margin:0; padding:0; }
header { background:#4cd964; color:white; padding:20px; text-align:center; font-size:28px; font-weight:700; }
.container { max-width:900px; margin:30px auto; padding:20px; background:white; border-radius:20px; box-shadow:0 10px 25px rgba(0,0,0,0.1); }
input, select, textarea { width:100%; padding:12px; margin:8px 0 15px 0; border-radius:10px; border:1px solid #ccc; font-size:16px; }
button { padding:12px 20px; border:none; border-radius:12px; background:#4cd964; color:white; font-weight:600; cursor:pointer; transition:0.3s; margin:5px 0; }
button:hover { background:#45c857; }
button.delete-btn { background:#e84118; }
button.delete-btn:hover { background:#c73814; }
.question-block { border:1px solid #ddd; padding:15px; margin-bottom:15px; border-radius:12px; }
.option-input { width:100%; margin:5px 0; padding:10px; border-radius:8px; border:1px solid #ccc; }
.quiz-item { border:1px solid #ddd; padding:12px; margin:10px 0; border-radius:12px; display:flex; justify-content:space-between; align-items:center; }
</style>
</head>
<body>

<header>Ph31 League - Admin Panel</header>
<div class="container">
  <h2>Upload Quiz for a Course</h2>

  <label for="courseSelect">Select Course:</label>
  <select id="courseSelect">
    <option value="">-- Select Course --</option>
    <option value="Analytical Chemistry">Analytical Chemistry</option>
    <option value="Pharmacognosy">Pharmacognosy</option>
    <option value="Organic Chemistry">Organic Chemistry</option>
    <option value="Pharmacy Orientation">Pharmacy Orientation</option>
    <option value="Scientific Writing">Scientific Writing</option>
  </select>

  <label for="quizDate">Quiz Date:</label>
  <input type="date" id="quizDate">

  <div id="questionsContainer"></div>
  <button onclick="addQuestion()">Add Question</button>
  <button onclick="uploadQuiz()" style="background:#2f80ed;">Upload Quiz</button>

  <h2 style="margin-top:40px;">Existing Quizzes</h2>
  <div id="existingQuizzes"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUzEzN0yXHHXWJbnYjfpkQVhQJDXAgd4o",
  authDomain: "ph31cli.firebaseapp.com",
  projectId: "ph31cli",
  storageBucket: "ph31cli.firebasestorage.app",
  messagingSenderId: "479571822414",
  appId: "1:479571822414:web:98b7b4e50177cc1acdc01f",
  measurementId: "G-HJF0WBCG9M"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let questionCount = 0;

function addQuestion(){
  questionCount++;
  const container = document.getElementById("questionsContainer");
  const div = document.createElement('div');
  div.className = 'question-block';
  div.id = 'question_'+questionCount;
  div.innerHTML = `
    <label>Question ${questionCount}:</label>
    <textarea placeholder="Enter question text" class="question-text"></textarea>
    <label>Options:</label>
    <input type="text" placeholder="Option A" class="option-input">
    <input type="text" placeholder="Option B" class="option-input">
    <input type="text" placeholder="Option C" class="option-input">
    <input type="text" placeholder="Option D" class="option-input">
    <label>Correct Answer (exact text):</label>
    <input type="text" placeholder="Correct Answer" class="correct-answer">
  `;
  container.appendChild(div);
}

function uploadQuiz(){
  const course = document.getElementById('courseSelect').value;
  const date = document.getElementById('quizDate').value;
  if(!course || !date){ alert("Select course and date!"); return; }

  const questionsBlocks = document.querySelectorAll('.question-block');
  if(questionsBlocks.length === 0){ alert("Add at least one question!"); return; }

  let questions = [];
  for(const block of questionsBlocks){
    const qText = block.querySelector('.question-text').value.trim();
    const opts = Array.from(block.querySelectorAll('.option-input')).map(o=>o.value.trim());
    const correct = block.querySelector('.correct-answer').value.trim();
    if(!qText || opts.some(o=>!o) || !correct){ alert("Fill all fields!"); return; }
    questions.push({ question_text: qText, options: opts, correct_answer: correct });
  }

  const quizId = course+"_"+date;
  db.collection("quizzes").doc(quizId).set({ course_id: course, date: date, questions })
    .then(()=>{ alert("Quiz uploaded successfully!"); document.getElementById('questionsContainer').innerHTML=''; questionCount=0; loadExistingQuizzes(); })
    .catch(err=>{ console.error(err); alert("Error uploading quiz."); });
}

function loadExistingQuizzes(){
  const container = document.getElementById('existingQuizzes');
  container.innerHTML='';
  db.collection("quizzes").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement('div');
      div.className = 'quiz-item';
      div.innerHTML = <span>${data.course_id} - ${data.date}</span>;
      const delBtn = document.createElement('button');
      delBtn.className = 'delete-btn';
      delBtn.innerText = 'Delete Quiz';
      delBtn.onclick = ()=>{
        if(confirm("Are you sure you want to delete this quiz?")){
          db.collection("quizzes").doc(doc.id).delete().then(()=>{
            div.remove();
            alert("Quiz deleted successfully!");
          });
        }
      };
      div.appendChild(delBtn);
      container.appendChild(div);
    });
  });
}

// Load quizzes on page load
loadExistingQuizzes();
</script>

</body>
</html>
